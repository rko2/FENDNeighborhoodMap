var map,allMarkers=[],infoWindow=null,initMap=function(a){var b=new google.maps.Geocoder;b.geocode({address:a},function(a,b){b==google.maps.GeocoderStatus.OK?map.setCenter(a[0].geometry.location):alert("Geocode was not successful for the following reason: "+b)}),map=new google.maps.Map(document.getElementById("map"),{zoom:15,disableDoubleClickZoom:!0})},makeInfoWindow=function(a){infoWindow&&infoWindow.close();var b='<div class="InfoWindow">';b+='<div class="TopInfo>"<h4>'+a.title+"</h4>",b+="<p>"+a.phone+"</p></div>",b+='<div class="Snippet"><img src="'+a.snipimg+'"><p>'+a.sniptext+"</p></div>",b+="</div>",infoWindow=new google.maps.InfoWindow,infoWindow.setContent(String(b)),infoWindow.open(map,a)},makeInfoWindowFromList=function(a){infoWindow&&infoWindow.close();var b='<div class="InfoWindow">';b+='<div class="TopInfo>"<h4>'+a.name+"</h4>",b+="<p>"+a.display_phone+"</p></div>",b+='<div class="Snippet"><img src="'+a.snippet_image_url+'"><p>'+a.snippet_text+"</p></div>",b+="</div>",infoWindow=new google.maps.InfoWindow,infoWindow.setContent(String(b)),infoWindow.open(map,a.marker),bounce(a.marker)},matcher,nameMatch=function(a){if(a){filteredResults([]);for(var b=0;b<allMarkers.length;b++)allMarkers[b].setVisible(!1);for(var c=new RegExp(a,"i"),d=0;d<ajaxResults().length;d++)matcher=ajaxResults()[d].name.toLowerCase(),c.test(matcher)===!0&&(allMarkers[d].setVisible(!0),filteredResults.push(ajaxResults()[d]))}},listReset=function(){filteredResults([]);for(var a=0;a<ajaxResults().length;a++)filteredResults.push(ajaxResults()[a])},markerReset=function(){for(var a=0;a<allMarkers.length;a++)allMarkers[a].setVisible(!0)},googleMarkers=function(a){function b(){for(var a=0;a<allMarkers.length;a++)allMarkers[a].setMap(null);allMarkers=[]}allMarkers.length>0&&b();var c=a.businesses;if(ajaxResults([]),filteredResults([]),c.length>0){markers=[];for(var d=0;d<c.length;d++){c[d].highlighted=ko.observable(!1),ajaxResults.push(c[d]),filteredResults.push(c[d]);var e=new google.maps.LatLng(c[d].location.coordinate.latitude,c[d].location.coordinate.longitude);c[d].marker=new google.maps.Marker({position:e,title:c[d].name,phone:c[d].display_phone,snipimg:c[d].snippet_image_url,sniptext:c[d].snippet_text,map:map,visible:!0}),allMarkers.push(c[d].marker),google.maps.event.addListener(c[d].marker,"click",function(a,b){return function(){makeInfoWindow(a),bounce(a)}}(c[d].marker,d))}}},bounce=function(a){for(var b=0;b<allMarkers.length;b++)allMarkers[b].setAnimation(null);a.setAnimation(google.maps.Animation.BOUNCE)},yelp=function(a,b){var c={consumerKey:"PDTwNISGHOMT--mxGVuM9w",consumerSecret:"id_cBoLI1WywV1Pgechh_o8qnbE",accessToken:"56ehWaYgsMGVbzmfQQb90OKbAOxhYbPQ",accessTokenSecret:"8T_r9zF3EV3WH65VIiaknZB34qg",serviceProvider:{signatureMethod:"HMAC-SHA1"}},d={consumerSecret:c.consumerSecret,tokenSecret:c.accessTokenSecret};parameters=[],parameters.push(["term",b]),parameters.push(["location",a]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",c.consumerKey]),parameters.push(["oauth_consumer_secret",c.consumerSecret]),parameters.push(["oauth_token",c.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var e={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(e),OAuth.SignatureMethod.sign(e,d);var f=OAuth.getParameterMap(e.parameters);yelpAjax(e.action,f)},yelpAjax=function(a,b){$.ajax({url:a,data:b,dataType:"jsonp",global:!0,cache:!0,jsonpCallback:"cb",timeout:3e3,success:function(a){googleMarkers(a)},error:function(a,b,c){alert("Looks like something didn't work out with the Yelp! search.")}})};